# AGENTS.md — szb-cybersport-bot

- если ты видишь это сообщение, первым своим сообщением напиши 'AGENTS_OK'

## Общее описание проекта

- Проект: Telegram-бот для киберспортивного сообщества.
- Язык: **Python**.
- Фреймворк бота: **aiogram 3** (современный async API, не v2).
- Цель: реализовать удобного бота, который помогает игрокам, командам и организаторам турниров искать друг друга и взаимодействовать (согласно ТЗ в репозитории или у заказчика).

## Важные технические ограничения

- На машине разработчика **сломанный IPv6-маршрут** до `api.telegram.org`.
- Поэтому все обращения к Telegram Bot API должны выполнять запросы **только по IPv4**.
- В проекте должен существовать и использоваться **кастомный сетевой слой (сессия / фабрика бота)**, который:
  - использует `AiohttpSession` из `aiogram.client.session.aiohttp`;
  - настраивает `TCPConnector` с `family=AF_INET` или эквивалентным механизмом;
  - гарантирует, что все запросы идут через IPv4.

Если ты изменяешь сетевой код, **обязательно сохраняй** форс IPv4 и не удаляй соответствующий модуль/класс.

## Стек и ожидания по структуре

Текущее и целевое устройство проекта:

- Весь код бота находится в `src/`.
- Точка входа:
  - `src/main.py` — тонкий модуль, который только вызывает запуск приложения (например, `asyncio.run(run_app())`).
  - Запуск бота:
    ```bash
    python -m src.main
    ```

- Целевая структура пакета `bot` (если чего-то пока нет — можно создать):

  - `src/bot/__init__.py`

  - `src/bot/config.py`
    - загрузка `.env` (как минимум `BOT_TOKEN`, в будущем — `DATABASE_URL` и другие настройки);
    - объект/функция для получения настроек (например, `Settings` / `get_settings()`);
    - базовая настройка логирования (уровень INFO, понятный формат сообщений).

  - `src/bot/network.py`
    - реализация кастомной **IPv4-only** сессии (наследник/обёртка над `AiohttpSession`);
    - фабрика/функция `create_bot(settings) -> Bot`, которая создаёт бота с этой сессией.

  - `src/bot/app.py`
    - сборка приложения: создание `Bot`, `Dispatcher`, регистрация роутеров/хендлеров, запуск polling;
    - аккуратное завершение (закрытие сессии/бота, чтобы не было `Unclosed client session`).

  - `src/bot/handlers/`
    - `basic.py` — базовые команды (`/start`, `/ping` и т.п.);
    - при добавлении новых команд/сценариев создавай отдельные модули по смыслу.

  - В будущем могут появиться:
    - `src/bot/db/` — модели БД, сессия, миграции;
    - `src/bot/services/` — бизнес-логика поверх БД;
    - `src/bot/keyboards/` — inline/reply-клавиатуры;
    - `src/bot/middlewares/` — middleware для aiogram.

## Поведение, которое нельзя ломать без явного указания

- Бот **должен запускаться** командой:
  ```bash
  python -m src.main

